### 0x00 基本概念

**系统运行时，计算机以进程为基本单位进行资源的调度和分配，在用户进行输入、输出中，则以文件为基本单位**。 文件系统提供了与二级存储相关的资源的抽象，让用户能在不了解文件的各种属性、文件存储介质的特征以及文件在存储介质上的具体位置等情况下，方便快捷地使用文件。

用户**通过文件系统**建立文件，提供应用程序的输入、输出，对资源进行管理。我们通过自底向上的形式来描述文件的结构如下：

* **数据项**：数据项是文件系统中最低级的数据组织形式，分为如下两种类型：
  * **基本数据项**：用于描述一个对象的某种属性的一个值，如姓名、日期或证件号等，**是数据中可命名的最小逻辑数据单位**，即**原子数据**。
  * **组合数据项**：由多个基本数据项组成
* **记录**：记录是**一组相关的数据项的集合**，用于描述**一个对象在某方面的属性**，如一个考生报名记录包括姓名、出生日期、报考学校代号、身份证等一系列域
* **文件**：文件是指**由创建者所定义的一组相关信息的集合**，逻辑上可分为两种：
  * 有结构文件：文件由**一组相似记录**组成，如报考某学校的所有考生的报考信息记录，又称为**记录式文件**
  * 无结构文件：则被看成是一个**字符流**，比如一个二进制文件或字符文件，又称为**流式文件**

文件属于**抽象数据类型**。文件有如下几个基本操作：

* 创建文件
* 写文件
* 读文件
* 删除文件
* **文件重定位**（或**文件寻址**）：按条目搜索目录，将当前文件设置为给定值，并且不会读、写文件
* **截断文件**：文件所有属性不变，并删除文件内容，将其长度置为0并释放空间

每个打开的文件都有如下关联信息：

* **文件指针**：系统跟踪**上次读写位置**作为当前文件位置指针，这种指针对打开文件的某个进程来说是唯一的，因此必须与磁盘文件属性分开保存
* **文件打开计数器**：文件关闭时，操作系统必须重用其打开文件表条目，否则表内空间不够用。因为多个进程可能打开同一个文件，所以系统在删除打开文件条目之前，必须等待最后一个进程关闭文件，该计数器跟踪打开和关闭的数量，当该计数为0时，**系统关闭文件，删除该条目**。
* **文件磁盘位置**：绝大多数文件操作都要求系统修改文件数据，**该信息保存在内存中，以免每个操作都从磁盘中读取**
* **访问权限**：每个进程打开文件都需要有一个访问模式（创建、只读、读写、添加等），**该信息保存在进程的打开文件表中**，以便操作系统能允许或拒绝之后的I/O请求

### 0x01 文件的逻辑结构

文件的逻辑结构是**从用户的观点出发**看到的文件的组织形式，文件的逻辑结构与存储介质特性无关。

#### 0x00 无结构文件

无结构文件是**最简单的文件组织形式**，又称为**流式文件**，无结构文件将数据按**顺序**组织为记录并累积保存，以字节（Byte）为单位，对其中记录的访问只能通过**穷举**的方式。

#### 0x01 有结构文件

有结构文件又称为**记录式文件**，按其组织形式可以进一步分为：

* **顺序文件**：文件中的记录一个接一个地顺序排列，记录通常是定长的。可以**顺序存储**或以**链表**的形式存储，在访问时按照顺序搜索文件，其又分为两种结构：

  * **串结构**：**记录之间的顺序与关键字无关**，比如由时间确定，按照存入时间的先后排列
  * **顺序结构**：**文件中所有记录按关键字顺序排列**

  对记录的批量操作中，**对顺序文件的效率是所有逻辑文件中最高的**，**只有顺序文件可以存储在磁带上**，但是**对顺序文件的查找、修改和增加比较困难**。

* **索引文件**：对变长记录文件只能进行顺序查找，系统开销较大，为此可以建立一张索引表以加快检索速度，**索引表本身是定长记录的顺序文件**。

* **索引顺序文件**：将顺序文件中的所有记录分为若干组，为顺序文件建立一张索引表，在索引表中**为每组中的第一个记录建立一个索引项**，其中含有该关键字的值以及指向该记录的指针。

