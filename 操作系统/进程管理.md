### 0x00 进程的基本概念

在多道程序环境下，允许多个程序并发执行，此时他们将失去封闭性，并具有间断性和不可再现的特性，为此引入进程的概念。同时为了使并发的程序和数据能独立地运行，必需为其单独配置一个进程控制块（PCB），**系统利用进程控制块来描述进程的基本情况和运行状态，进而控制和管理进程**。相应地，**由程序段、相关数据段和PCB三部分构成了进程映像（进程实体）**。创建进程即为创建进程映像中的PCB，撤销进程实质上也是撤销的进程的PCB。由此也说明了**PCB是进程存在的唯一标识**。**进程映像是静态的，进程则是动态的**。

进程的基本特征：

* **动态性**：即为进程有着创建、活动、暂停、终止等过程，具有一定的生命周期。
* **并发性**：指的是多个进程实体同存在于内存中，内在一段时间内同时运行。
* **独立性**：指进程实体是一个能独立运行、独立获得资源和独立接受调度的基本单位。凡未建立PCB的程序都不能作为一个独立的单位参与运行。
* **异步性**：进程具有执行的间断性，即进程按各自独立的、不可预知的速度向前推进。**异步性会导致执行结果的不可再现性**，为此操作系统必须配置相应的进程同步机制。
* **结构性**：每个进程都有一个PCB对其进行描述，从结构上看，进程实体是由程序段、数据段和进程控制段三部分组成。

其中，**动态性是进程最基本的特征**。

进程的状态与转换：

* **运行状态**
* **就绪状态**：进程得到了除处理机以外的一切所需资源已处于准备运行的状态。一旦得到处理机就可以运行。处于运行状态的进程时间片用完之后不得不让出处理机，此时进程就由运行状态转化为就绪状态。
* **阻塞状态**：又称**等待状态**，进程正在等待某一时间而暂停，例如等待用户输入
* **创建状态**：进程正在被创建，尚未转到就绪状态，进程的创建往往具有多个步骤：首先申请一个空白的PCB，并向PCB中填写一些控制和管理进程的信息，然后系统为该进程分配所需的资源，最后把该进程切换到就绪状态。
* **结束状态**：当进程需要结束运行时，系统首先将其置为结束状态，然后进一步处理资源释放和回收工作。

### 0x01 进程控制

#### 0x00 进程创建

操作系统允许一个进程创建另一个进程，而且允许子进程继承父进程所拥有的资源，当子进程被撤销时，其在父进程处继承的资源应当还给父进程。同时，撤销父进程时同时也会撤销其所有的子进程。创建进程的过程如下（**创建原语**）：

* 为新进程分配一个唯一的进程标识号，并申请一个空白的PCB，PCB是有限的，若申请失败则创建失败
* 为进程分配资源，**此处如果资源不足，进程就会进入等待状态，以等待资源**
* 初始化PCB
* 如果进程的调度队列能够接纳新进程，那就将进程插入到就绪队列，等待被调度运行

#### 0x01 进程终止

进程可以有3种终止方式：正常结束、异常结束以及外界干预（任务管理器）。

操作系统终止进程的过程如下（撤消原语）：

* 根据被终止进程的标识符，检索PCB，从中读出该进程的状态
* 若处于执行状态，则立即终止该进程的执行，然后将处理机资源分配给其他进程
* 若其还有子进程，则应将其所有子进程终止
* 将该进程所拥有的全部资源都归还给父进程或操作系统
* 将其从PCB所在队列中删除

#### 0x02 进程的阻塞和唤醒

阻塞原语：

* 找到将要被阻塞进程标识号对应的PCB
* 若其为运行状态，则保护其现场，将其状态转为阻塞状态，停止运行
* 将该PCB插入到相应时间的等待队列中去

唤醒原语：

* 在该事件的等待队列中找到相应进程的PCB
* 将其从等待队列中移出，并置其状态为就绪状态
* 把该PCB插入到就绪队列中，等待调度程序调度

注意**阻塞原语是由被阻塞进程自我调用实现的，而唤醒原语是一个由与被唤醒进程相合作或被其他相关进程调用实现的**。

#### 0x03 进程切换

进程切换过程如下：

* 保存处理机上下文，包括程序计数器和其他存储器
* 更新PCB信息
* 把进程的PCB移入响应的队列
* 选择另一个进程执行并更新其PCB
* 更新内存管理的数据结构
* 恢复处理机上下文

进程切换与处理机的模式切换要注意区分哦。进程切换时是进程变了，处理机模式切换后可能还处在同一进程中。

### 0x02 进程的组成部分

#### 0x00 进程控制块PCB

进程创建后操作系统就会创建一个新的进程控制块，**此后就常驻内存**。在任一时刻可以存取，进程结束时删除。**PCB是进程实体的一部分是进程存在的唯一标识**。下面说一下PCB的主要组成部分：

* **进程描述信息**
  * 进程标识符：标识各个进程，每个进程都有一个并且唯一的标识符
  * 用户标识符：进程归属的用户，用户标识符主要为共享和保护服务
* **进程控制和管理信息**
  * 进程当前状态
  * 进程优先级：进程抢占处理机时的优先级
* **资源分配清单**：说明有关内存地址空间或虚拟地址空间的状况，所打开文件的列表和所使用的I/O设备信息
* **处理机相关信息**：处理机中各个寄存器的值，当进程被切换时，处理机的状态信息都会被保存在响应的PCB中，以便进程重新执行时，能从断点处继续执行

目前操作系统中有2种方式来组织各个进程的PCB，即为链接方式和索引方式：

* 链接方式：将处于同一状态的PCB链接成一个队列，不同的状态对应不同的队列
* 索引方式：将同一状态的进程组织在一个索引表中，索引表项指向相应的PCB，不同状态对应不同的索引表

#### 0x01 其他

程序段：就是能被进程调度程序调度到CPU执行的程序代码段

数据段：进程对应程序加工处理的原始数据或者执行时产生的中间数据或者结果。

### 0x03 进程的通信

在这只写高级通信方法：

* 共享存储：两个互相通信的进程之间存在一块可直接访问的共享空间以实现信息的交换。在对共享空间进行读写操作时，需要使用**同步互斥工具**对读写进行控制。共享存储又分为两种方式：基于数据结构共享的低级方式以及基于存储区共享的高级方式。
* 消息传递：进程通过系统提供的发送消息和接受消息两个原语进行数据交换：
  * 直接通信方式：发送进程把消息直接发送给接受进程，并将其挂在接受进程消息缓冲队列上
  * 间接通信方式：发送进程消息把消息发送到某个中间实体，然后接收方再从中间实体出取得
* 管道通信：**管道是指用于连接一个读进程和一个写进程以实现其互相同通信的一个共享文件**，从管道中读数据是一次性的操作，数据一旦被读取即会从管道中删除。由此，**管道通信是半双工通信**。

