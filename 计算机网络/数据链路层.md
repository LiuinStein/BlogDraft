### 0x00 基本功能

功能：

* 为网络层提供服务
  * 无确认的无连接：适用于**实时通信**，如**以太网**
  * 有确认的无连接：适用于**误码率较高**的场合，如**无线通信**
  * 有确认的面向连接的：适用于**可靠性实时性较高**的场合
  * **就是没有无确认的有连接**
* 链路管理：链路建立、维持和释放
* 组帧
  * 定义帧的数据格式
  * 帧定界：确定帧的界限，添加首部和尾部，用标志位F（0111 1110）
  * 帧同步：发送方和接收方都能区分出帧的起始和终止
* 透明传输：保证任何数据都能在链路上传输
* 流量控制：实际上**限制发送方的**数据流量，以防接收方跟不上
* 差错控制

### 0x01 组帧

* **字符计数法**：在头部加一个字段来标识帧内的字符数，知道这个数即可确定帧的结束位置，最大的问题在于，如果这个数出错将会带来灾难性后果。
* **字符填充的首尾定界符法**：在头部和尾部加一些特定的字符来标识开始和结尾，信息位中如果有相同的字符，就使用转义字符将其转义
* **比特填充的首尾标志法**：用0111 1110作为首尾的界限，如果数据段中每出现5个1就在后面加个0
* **违规编码法**：**局域网**使用的就是这种方法，例如在曼彻斯特编码中就没有出现高-高这样的电平对，所以就用这种违规编码来标识帧的首尾

### 0x02 差错控制

差错的引发：

* 随机热噪声：信道所固有的，持续存在的，引起的差错为**随机差错**，通过**提高信噪比**可以减少其对数据传输的影响
* 冲击噪声：是引起传输差错的**主要原因**

差错控制：

* 自动重传请求（ARQ）：接收端只能检测出差错，然后要求重传
* 前向纠错（FEC）：不但能发现差错，还能**确定差错的位置**

检错编码：

* 奇偶校验码：加一个标志位使其有偶数个1（偶校验）或奇数个1（奇校验），如果采用奇校验，则如果传输的结果中有偶数个1那么可以检测出差错来，如果具有奇数个1则检测不出差错

* CRC循环冗余码：可以使用硬件完成，带有r个校检位的多项式编码可以检测到所有**长度小于等于r**的突发性错误。
  $$
  \text{CRC的计算} \\
  首先会有一个生成多项式，可能写成G(x)=x^4+x+1或者10011的形式 \\
  最高项的次数即为r，如果是二进制数的形式即为位数-1，上述2例中r=4 \\
  \text{CRC的生成}：在发送序列后加入r个0，然后使用模2除法计算余数 \\
  将计算所得的余数附加至发送序列后面即得到\text{CRC序列} \\
  \text{CRC的检验}：将发送过来的序列与生成多项式使用使用模2除法计算余数 \\
  若余数为0则该二进制序列在传输过程中没有出现差错
  $$
  下图为对发送序列101001使用生成多项式1101（或$G(x)=x^3+x^2+1$）使用模2除法计算余数的过程：

  ![](https://bucket.shaoqunliu.cn/image/0239.png)
  故：所得发送序列为101001 001

纠错编码：

* 海（汉）明码：能发现双比特错，但只能纠正单比特错，**纠错D位，需要码距（海明距）为`2d+1`的编码方案，检错d位，需要码距为`d+1`的编码方案**。对于n位要传输的信息，需要**增加的冗余信息位数r必需满足**$2^r\geqslant n+r+1$。

### 0x03 流量控制

数据链路层上的流量控制是对**链路上的帧的发送速率**的控制，以便**接收方有足够的缓冲空间**来接受每一帧。

停止等待流量控制：发送方发送每一帧后都等待接收方的应答信号，此后才能发送下一帧。如果接收方不反馈应答信号，则发送方必需一直等待。这种方式**每次仅发送一帧**，然后就陷入等待，效率低下。

滑动窗口流量控制的特性：

* 发送窗口代表**还没有收到对方确认信息之前**最多还可以发送多少个数据帧
* **只有接收窗口向前滑动时，发送窗口才有可能向前滑动**
* 当**接收窗口大小为1时才能保证帧的有序接收**
* **数据链路层的**滑动窗口大小在传输过程中是**固定的**
* 从滑动窗口的概念看，几个协议只在发送和接受窗口的概念上有所差别
  * 停止-等待协议：发送窗口=接收窗口=1
  * 后退N帧协议：发送窗口>1，接收窗口=1
  * 选择重传协议：发送窗口和接收窗口均>1

数据链路层的可靠传输通常使用**确认**和**超时重传**两种机制完成。

#### 0x00 后退N帧协议(GBN)

当接受方检测出失序的信息帧后，要求发送方重发**最后一个正确接受的信息帧之后的所有未被确认的帧**。

GBN的确认机制为**累积确认**，即为接收方不必对收到的分组逐个发送确认，而是可以在收到几个分组后，**对按序到达的最后一个分组加以确认**。比如发送方发送编号为0~7的帧，接收方对第0,2,3,7个帧发送确认，就是分别对第0个帧的确认，对第1,2个帧的确认，对第3个帧的确认，对第4,5,6,7个帧的确认。

GBN中接收窗口为1，且**发送窗口大小满足**$1\leqslant W_T \leqslant2^n-1$，其中$W_T$为发送窗口大小，采用n个比特对帧编号。

在GBN下要想使信道利用率高，那就**让帧最小单位时间内尽量多发帧**。同时发送窗口的大小要依据发送帧到收到确认的总时间。

#### 0x01 选择重传协议(SR)

选择重传不像GBN一样，不具有累积确认机制，所以哪几个帧没收到就重传哪几个帧。若采用n比特对帧编号的话，**接收窗口的尺寸不应超过需要范围的一半即**$W_R \leqslant 2^{n-1}$，当接收窗口为最大值时，发送窗口$W_R=W_T=2^{n-1}$

若发送窗口**上边界**对应的帧序号为U，则发送窗口**下边界**对应的帧序号$\geqslant (U-W+1)~\text{mod}~2^k$，其中W为接受窗口大小，k为帧的序号长度。

#### 0x02 计算

链路利用率
$$
链路利用率=\frac{t_{发送数据}}{t_{发送数据}+k\cdot t_{单向传播延迟}}\\
其中k为系数，当链路使用停止-等待协议时，k=2 \\
当链路采用滑动窗口协议时，k=1
$$

### 0x04 介质访问控制

静态划分信道：

* 信道划分介质访问控制
  * 频分多路复用（FDM）：相邻信道之间需加入**保护频带**，此方法充分利用了传输介质的带宽，同一时间同时发送多路信号，**系统效率较高**，实现起来较为方便
  * 时分多路复用（TDM)：将物理信道按时间划分为时间片，轮流分给多个信号使用，分为TDM和STDM，假设线路速率为8kbps，有4个用户使用，TDM每个用户最高2kbps，而STDM每个用户最高8kbps
  * 波分多路复用（WDM）：用于**光纤**，依据光的波长不同，此方法**带宽较高**
  * 码分多路复用（CDM）：用**不同的编码**来区分，此方法**既共享信道频率，又共享信道时间**，

动态划分信道：

* 随机访问介质访问控制
* 轮询访问介质访问控制